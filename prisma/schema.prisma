generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model ambulance {
  ambulance_id     Int                        @id @default(autoincrement())
  hospital_id      Int
  ambulance_type   ambulance_ambulance_type
  ambulance_status ambulance_ambulance_status
  plate_no         String                     @unique(map: "plate_no") @db.VarChar(7)
  created_at       DateTime                   @default(now()) @db.DateTime(0)
  updated_at       DateTime?                  @default(now()) @db.DateTime(0)
  is_deleted       Boolean                    @default(false)
  hospital         hospital                   @relation(fields: [hospital_id], references: [hospital_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_ambulance_hospital_id")
  dispatch         dispatch[]
  preassign        preassign[]
  transfer         transfer[]

  @@index([hospital_id], map: "fk_ambulance_hospital_id")
}

model hospital {
  hospital_id        Int                  @id @default(autoincrement())
  hospital_name      String               @db.VarChar(50)
  city               hospital_city
  street             String               @db.VarChar(20)
  created_at         DateTime             @default(now()) @db.DateTime(0)
  updated_at         DateTime?            @default(now()) @db.DateTime(0)
  is_deleted         Boolean              @default(false)
  ambulance          ambulance[]
  reference_location reference_location[]
  request            request[]
  staff              staff[]
  transfer           transfer[]
}

model patient {
  patient_id         Int                       @id @default(autoincrement())
  ref_location_id    Int
  name               String                    @db.VarChar(50)
  age                Int?
  medical_condition  patient_medical_condition
  priority_level     patient_priority_level
  contact_person     String?                   @db.VarChar(50)
  contact_number     String?                   @unique(map: "contact_number") @db.Char(11)
  transfer_status    patient_transfer_status?
  created_at         DateTime                  @default(now()) @db.DateTime(0)
  updated_at         DateTime?                 @default(now()) @db.DateTime(0)
  is_deleted         Boolean                   @default(false)
  reference_location reference_location        @relation(fields: [ref_location_id], references: [ref_location_id], map: "fk_patient_location")
  request            request[]
  transfer           transfer[]

  @@index([ref_location_id], map: "fk_patient_location")
}

model reference_location {
  ref_location_id Int                     @id @default(autoincrement())
  hospital_id     Int
  city            reference_location_city
  street          String                  @db.VarChar(20)
  created_at      DateTime                @default(now()) @db.DateTime(0)
  updated_at      DateTime?               @default(now()) @db.DateTime(0)
  patient         patient[]
  hospital        hospital                @relation(fields: [hospital_id], references: [hospital_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_reflocation_hospital")
  request         request[]

  @@index([hospital_id], map: "fk_reflocation_hospital")
}

model staff {
  staff_id       Int                  @id @default(autoincrement())
  hospital_id    Int
  name           String               @db.VarChar(50)
  staff_role     staff_staff_role
  license_no     String               @unique(map: "license_no") @db.VarChar(11)
  shift_schedule staff_shift_schedule
  staff_status   staff_staff_status
  created_at     DateTime             @default(now()) @db.DateTime(0)
  updated_at     DateTime?            @default(now()) @db.DateTime(0)
  is_deleted     Boolean              @default(false)
  preassign      preassign[]
  hospital       hospital             @relation(fields: [hospital_id], references: [hospital_id], onDelete: NoAction, onUpdate: NoAction, map: "fk_staff_hospital")
  transfer       transfer[]

  @@index([hospital_id], map: "fk_staff_hospital")
}

model transfer {
  transfer_id     Int                      @id @default(autoincrement())
  patient_id      Int
  ambulance_id    Int
  staff_id        Int
  hospital_id     Int
  transferred_on  DateTime                 @db.DateTime(0)
  transfer_status transfer_transfer_status
  priority_level  transfer_priority_level?
  updated_on      DateTime?                @default(now()) @db.DateTime(0)
  patient         patient                  @relation(fields: [patient_id], references: [patient_id], onDelete: Cascade, onUpdate: NoAction, map: "fk_transfer_patient")
  ambulance       ambulance                @relation(fields: [ambulance_id], references: [ambulance_id], onUpdate: NoAction, map: "fk_transfer_ambulance")
  hospital        hospital                 @relation(fields: [hospital_id], references: [hospital_id], onUpdate: NoAction, map: "fk_transfer_hospital")
  staff           staff                    @relation(fields: [staff_id], references: [staff_id], onUpdate: NoAction, map: "transfer_ibfk_4")

  @@index([staff_id], map: "staff_id")
  @@index([ambulance_id], map: "ambulance_id")
  @@index([hospital_id], map: "hospital_id")
  @@index([patient_id], map: "patient_id")
}

model dispatch {
  dispatch_id     Int                      @id @default(autoincrement())
  request_id      Int                      @unique(map: "request_id")
  ambulance_id    Int
  dispatched_on   DateTime                 @default(now()) @db.DateTime(0)
  dispatch_status dispatch_dispatch_status @default(dispatched)
  created_on      DateTime                 @default(now()) @db.DateTime(0)
  request         request                  @relation(fields: [request_id], references: [request_id], onDelete: NoAction, onUpdate: NoAction, map: "dispatch_ibfk_1")
  ambulance       ambulance                @relation(fields: [ambulance_id], references: [ambulance_id], onDelete: NoAction, onUpdate: NoAction, map: "dispatch_ibfk_2")

  @@index([ambulance_id], map: "ambulance_id")
}

model preassign {
  preassign_id      Int                          @id @default(autoincrement())
  staff_id          Int
  staff_role        preassign_staff_role
  ambulance_id      Int
  assignment_status preassign_assignment_status? @default(active)
  assigned_on       DateTime                     @default(now()) @db.DateTime(0)
  updated_on        DateTime?                    @default(now()) @db.DateTime(0)
  staff             staff                        @relation(fields: [staff_id], references: [staff_id], onDelete: NoAction, onUpdate: NoAction, map: "preassign_ibfk_1")
  ambulance         ambulance                    @relation(fields: [ambulance_id], references: [ambulance_id], onDelete: NoAction, onUpdate: NoAction, map: "preassign_ibfk_2")

  @@unique([ambulance_id, staff_role], map: "unique_ambulance_role")
  @@unique([staff_id, assigned_on], map: "unique_staff_time")
}

model request {
  request_id         Int                    @id @default(autoincrement())
  patient_id         Int
  ref_location_id    Int
  hospital_id        Int
  priority_level     request_priority_level
  request_status     request_request_status @default(pending)
  requested_on       DateTime               @default(now()) @db.DateTime(0)
  updated_on         DateTime?              @default(now()) @db.DateTime(0)
  dispatch           dispatch?
  patient            patient                @relation(fields: [patient_id], references: [patient_id], onDelete: NoAction, onUpdate: NoAction, map: "request_ibfk_1")
  reference_location reference_location     @relation(fields: [ref_location_id], references: [ref_location_id], onUpdate: NoAction, map: "request_ibfk_2")
  hospital           hospital               @relation(fields: [hospital_id], references: [hospital_id], onDelete: NoAction, onUpdate: NoAction, map: "request_ibfk_3")

  @@index([hospital_id], map: "hospital_id")
  @@index([patient_id], map: "patient_id")
  @@index([ref_location_id], map: "ref_location_id")
}

enum ambulance_ambulance_type {
  type_1
  type_2
}

enum staff_staff_role {
  driver
  emt
  paramedic
}

enum ambulance_ambulance_status {
  available
  on_trip
}

enum patient_medical_condition {
  cardiac
  trauma
  respiratory
  neurological
  other
}

enum staff_shift_schedule {
  morning
  night
}

enum patient_priority_level {
  critical
  moderate
  routine
}

enum staff_staff_status {
  available
  in_transfer
  off_duty
}

enum transfer_priority_level {
  critical
  moderate
  routine
}

enum patient_transfer_status {
  waiting
  in_transfer
  transferred
}

enum preassign_staff_role {
  driver
  emt
  paramedic
}

enum hospital_city {
  Quezon_City
  Manila_City
  Muntinlupa_City
}

enum request_priority_level {
  critical
  moderate
  routine
}

enum preassign_assignment_status {
  active
  completed
  cancelled
}

enum request_request_status {
  pending
  accepted
  cancelled
}

enum reference_location_city {
  Quezon_City
  Manila_City
  Muntinlupa_City
}

enum transfer_transfer_status {
  transferred
}

enum dispatch_dispatch_status {
  completed
  dispatched
  cancelled
}
